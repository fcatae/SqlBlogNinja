<a link='https://blogs.msdn.microsoft.com/fcatae/2012/01/23/desafio-cad-meu-join/'>Desafio: Cadê meu Join?</a>
<p>Dessa vez apresento um desafio curioso que recebi esses dias enquanto estava no escritório. Uma pessoa me apresentou uma consulta SQL que relacionava os dados de cliente com os endereços.</p> <blockquote><font color="#0000ff" size="2" face="Courier New"> <p align="left">SELECT</font><font color="#000000" size="2" face="Courier New"><b> c</font><font color="#808080" size="2" face="Courier New"></b>.*</font><font color="#000000" size="2" face="Courier New"><b> </font><font color="#0000ff" size="2" face="Courier New"></b>FROM</font><font color="#000000" size="2" face="Courier New"><b> Clientes c </font><font color="#808080" size="2" face="Courier New"></b><font style="background-color: #ffff00">LEFT OUTER</font></font><font color="#000000" size="2" face="Courier New"><b><font style="background-color: #ffff00"> </font></font><font color="#808080" size="2" face="Courier New"></b><font style="background-color: #ffff00">JOIN</font></font><font color="#000000" size="2" face="Courier New"><b> Regioes r <br></b></font><font color="#0000ff" size="2" face="Courier New">ON</font><font color="#000000" size="2" face="Courier New"><b> c</font><font color="#808080" size="2" face="Courier New"></b>.</font><font color="#000000" size="2" face="Courier New">regiaoId </font><font color="#808080" size="2" face="Courier New">=</font><font color="#000000" size="2" face="Courier New"><b> r</font><font color="#808080" size="2" face="Courier New"></b>.</font><font color="#000000" size="2" face="Courier New">regiaoId </font><font color="#808080" size="2" face="Courier New">AND<br></font><font color="#000000" size="2" face="Courier New"><b>r</font><font color="#808080" size="2" face="Courier New"></b>.</font><font color="#000000" size="2" face="Courier New">regiaoId </font><font color="#808080" size="2" face="Courier New">IS</font><font color="#000000" size="2" face="Courier New"><b> </font><font color="#808080" size="2" face="Courier New"></b>NULL</font></p></blockquote> <p>O interessante é que o plano de execução gerada não possui JOIN entre tabelas. Surge a pergunta: CADÊ MEU JOIN???</p> <blockquote> <p><a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/28/29/metablogapi/8507.image_069DDB6F.png"><img style="border-bottom: 0px;border-left: 0px;padding-left: 0px;padding-right: 0px;border-top: 0px;border-right: 0px;padding-top: 0px" title="image" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/28/29/metablogapi/2318.image_thumb_73E8E1B7.png" width="215" height="80"></a></p></blockquote> <p>O problema fica mais interessante quando substituimos o <strong>LEFT OUTER JOIN </strong>por um <strong>INNER JOIN</strong>, pois o plano de execução não apresenta a leitura em nenhuma tabela.</p> <blockquote><font color="#0000ff" size="2" face="Courier New"> <p align="left">SELECT</font><font color="#000000" size="2" face="Courier New"><b> c</font><font color="#808080" size="2" face="Courier New"></b>.*</font><font color="#000000" size="2" face="Courier New"><b> </font><font color="#0000ff" size="2" face="Courier New"></b>FROM</font><font color="#000000" size="2" face="Courier New"><b> Clientes c </font><font color="#808080" size="2" face="Courier New"></b><font style="background-color: #ffff00">INNER</font></font><font color="#000000" size="2" face="Courier New"><b><font style="background-color: #ffff00"> </font></font><font color="#808080" size="2" face="Courier New"></b><font style="background-color: #ffff00">JOIN</font></font><font color="#000000" size="2" face="Courier New"><b> Regioes r<br></b></font><font color="#0000ff" size="2" face="Courier New">ON</font><font color="#000000" size="2" face="Courier New"><b> c</font><font color="#808080" size="2" face="Courier New"></b>.</font><font color="#000000" size="2" face="Courier New">regiaoId </font><font color="#808080" size="2" face="Courier New">=</font><font color="#000000" size="2" face="Courier New"><b> r</font><font color="#808080" size="2" face="Courier New"></b>.</font><font color="#000000" size="2" face="Courier New">regiaoId </font><font color="#808080" size="2" face="Courier New">AND<br></font><font color="#000000" size="2" face="Courier New"><b>r</font><font color="#808080" size="2" face="Courier New"></b>.</font><font color="#000000" size="2" face="Courier New">regiaoId </font><font color="#808080" size="2" face="Courier New">IS</font><font color="#000000" size="2" face="Courier New"><b> </font><font color="#808080" size="2" face="Courier New"></b>NULL</font></p></blockquote> <blockquote> <p><a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/28/29/metablogapi/2630.image_2C938BC5.png"><img style="border-bottom: 0px;border-left: 0px;padding-left: 0px;padding-right: 0px;border-top: 0px;border-right: 0px;padding-top: 0px" title="image" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/28/29/metablogapi/2627.image_thumb_653E35D2.png" width="209" height="63"></a></p></blockquote> <p>A pergunta desse Desafio Ninja é:</p> <blockquote> <p><strong>O que aconteceu com o Join de tabela e com a operação de Table Scan?</strong></p></blockquote> <p>Poste sua opinião e resposta na seção de comentários. </p> <p><u></u>&nbsp;</p> <p><u>Script usado:</u></p> <table border="0" cellspacing="0" cellpadding="2" width="572"> <tbody> <tr> <td valign="top" width="570"> <p><font size="2" face="Courier New">CREATE TABLE Regioes<br>&nbsp; (regiaoId INT PRIMARY KEY, <br></font><font size="2" face="Courier New">&nbsp;&nbsp; local VARCHAR(100) NOT NULL)<br></font><font size="2" face="Courier New"><br>CREATE TABLE Clientes<br></font><font size="2" face="Courier New">&nbsp; (id INT, <br>&nbsp;&nbsp; nome VARCHAR(50), <br>&nbsp;&nbsp; regiaoId INT FOREIGN KEY REFERENCES Regioes(regiaoId))</font></p> <p><font size="2" face="Courier New">INSERT Regioes VALUES (1, 'Norte'), (2, 'Sul')<br>INSERT Clientes VALUES (1, 'Cliente1', 1), (2, 'Cliente2', 1)<br>GO</font></p> <p><font size="2" face="Courier New">SELECT c.* FROM Clientes c LEFT JOIN Regioes r <br>ON&nbsp;&nbsp;&nbsp; c.regiaoId = r.regiaoId AND<br>&nbsp;&nbsp;&nbsp; r.regiaoId IS NULL</font></p> <p><font size="2" face="Courier New">SELECT c.* FROM Clientes c INNER JOIN Regioes r <br>ON&nbsp;&nbsp;&nbsp; c.regiaoId = r.regiaoId AND <br>&nbsp;&nbsp;&nbsp; r.regiaoId IS NULL</font></p></td></tr></tbody></table>
